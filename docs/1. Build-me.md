# Build me (joke.devside.no)
### Overview
Goal is to build asap an obnoctious app that on "joke" signal sends push messages and flashes big ass text that says "JOKE" with flashing background and text color with as high contrast as possible, while a recording of me in russian saying "oj blyat, eta shutka, eta shutka" is playing on all devices that have this PWA installed.

Stack:
- sveltekit
- typescript
- firebase
- my vps

deployment is already set up, just need to make the app

I will have login option where I type a simple password that's hardcoded, let it be "jester123" for now, and I'll get the ability to broadcast "joke" option (only i can start / stop it)

when joke mode is on, all PWA devices that have installed this app / all website users with notifications on will

this will almost only be used on mobilw

for audio recording check static/sound.mp3

Make sure to have proper client and server logging

MAKE THIS AS EASY AS POSSIBLE, AND THE LEAST COMPLICATED POSSIBLE

Here's some firebase info to get ya started:


// Import the functions you need from the SDKs you need
import { initializeApp } from "firebase/app";
// TODO: Add SDKs for Firebase products that you want to use
// https://firebase.google.com/docs/web/setup#available-libraries

// Your web app's Firebase configuration
const firebaseConfig = {
  apiKey: "AIzaSyAR2DBerIXFqlT-tXfaeUNmTQ8OuV9b1TM",
  authDomain: "joke-devside-no.firebaseapp.com",
  projectId: "joke-devside-no",
  storageBucket: "joke-devside-no.firebasestorage.app",
  messagingSenderId: "884157295428",
  appId: "1:884157295428:web:f7d42cfdd7e8ca3519c511"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);

just tell me later which features to turn on

---

### What was built (MVP)
- A minimal SvelteKit PWA with:
  - a realtime Firestore-backed “joke mode” switch
  - a giant flashing “JOKE” screen on clients when active
  - looping audio playback from `static/sound.mp3` while joke mode is on
  - local notification (via the Service Worker) when joke mode turns on
  - a dead-simple admin unlock with password `jester123` to start/stop broadcast
- No UI sugar. Works on mobile. Logging via `console.info/error`.

### How it works
- Home page (`/`) subscribes to Firestore doc `state/joke` and reacts in realtime.
- When `active = true`:
  - Screen flashes aggressively.
  - If user previously tapped “Enable sound”, the audio loops at full volume.
  - If notifications are allowed, a local notification is shown via the SW.
- When `active = false`:
  - Audio pauses and resets.
- Admin unlock:
  - Enter `jester123` then click Unlock. This is stored in `localStorage` for convenience.
  - “Start JOKE” sets `state/joke.active = true`, “Stop JOKE” sets it to false.

### Files of interest
- App shell and PWA:
  - `src/app.html` — links the manifest.
  - `static/manifest.webmanifest` — basic PWA manifest.
  - `static/service-worker.js` — registers, simple precache, shows local notifications.
  - `src/routes/+layout.svelte` — registers the SW.
- Feature logic:
  - `src/lib/firebase.ts` — bootstraps Firebase SDK with the provided config.
  - `src/lib/jokeState.ts` — Firestore subscribe/set helpers for `state/joke`.
  - `src/routes/+page.svelte` — UI: admin unlock, toggle, flashing screen, audio.
- Assets:
  - `static/sound.mp3` — the “oj blyat, eta shutka…” audio (looped).

### Firebase setup (turn these on)
1) Enable Firestore (in Native mode) in the Firebase Console for project `joke-devside-no`.
2) Temporary rules for MVP testing (make it work fast, lock down later):
   - Allow read by anyone.
   - Allow write to `state/joke` (so you can toggle). Example rule sketch (Console → Firestore → Rules):
     ```
     rules_version = '2';
     service cloud.firestore {
       match /databases/{database}/documents {
         match /state/joke {
           allow read: if true;
           allow write: if true; // tighten later
         }
       }
     }
     ```
   Replace with proper auth later if needed.

### Push notifications (optional / later)
- This MVP uses local notifications from the active page via the SW (no server).
- If you want real background push:
  1) Enable Cloud Messaging.
  2) Generate a Web Push certificate (VAPID) in Firebase Console.
  3) Expose the VAPID public key to the client (e.g. via `PUBLIC_FCM_VAPID_KEY`) and request an FCM token.
  4) Use a server (your VPS) with Firebase Admin SDK or HTTP v1 API to send a topic/registration-token message when `state/joke` turns on.
  5) Add a `firebase-messaging-sw.js` that handles background push and shows notifications.
- Not implemented to keep the MVP as simple as possible, but the SW and structure are ready.

### Operational notes
- Logs:
  - Client logs use `console.info/error` with clear prefixes `[PWA]`, `[Firebase]`, `[Firestore]`, `[Audio]`, `[Joke]`, `[Admin]`, `[Notify]`.
- Sound:
  - Browsers require a user gesture to play audio. Tap “Enable sound” once per device.
  - We persist `audioEnabled=1` in `localStorage` after a successful play.
- Persistence:
  - Admin unlock and audio enabled flags are stored in `localStorage` and restored on load.
- PWA install:
  - Manifest is present; the SW is registered. On iOS you may need “Add to Home Screen”.

### Running locally
```
yarn
yarn dev
```
Open `http://localhost:5173`. Unlock admin (password `jester123`) and press “Start JOKE”.

### Deploy
- The repo uses Node adapter and a standard Vite/SvelteKit build:
```
yarn build
yarn preview
```
Your existing deploy workflow should pick this up.

### Next hardening steps (when you care)
- Lock Firestore rules to only allow writes from authenticated admin.
- Replace hardcoded password with real auth (Firebase Auth or your own).
- Add server-side push (FCM) if you need background wakeups when the app is closed.
- Consider a “test siren” button that only affects the current device.
- Add metrics (counts of active devices, last ping, etc.) in Firestore.